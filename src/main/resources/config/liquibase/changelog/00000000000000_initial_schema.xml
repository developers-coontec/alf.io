<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd">
    <changeSet author="jungsoo" id="1651569389840-1">
        <createTable tableName="flyway_schema_history">
            <column name="installed_rank" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="flyway_schema_history_pk"/>
            </column>
            <column name="version" type="VARCHAR(50)"/>
            <column name="description" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="script" type="VARCHAR(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="checksum" type="INTEGER"/>
            <column name="installed_by" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="installed_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="execution_time" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="success" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-2">
        <createTable tableName="special_price">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="special_price_pkey"/>
            </column>
            <column name="code" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="ticket_category_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="session_id" type="VARCHAR(255)"/>
            <column name="sent_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="recipient_name" type="VARCHAR(255)"/>
            <column name="recipient_email" type="VARCHAR(255)"/>
            <column name="organization_id_fk" type="INTEGER"/>
            <column name="access_code_id_fk" type="INTEGER"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-3">
        <createTable tableName="organization">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="organization_pkey"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="name_openid" type="VARCHAR(255)"/>
            <column name="slug" type="TEXT"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-4">
        <createTable tableName="ba_user">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ba_user_pkey"/>
            </column>
            <column name="username" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="first_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="email_address" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="true" name="enabled" type="BOOLEAN"/>
            <column defaultValue="INTERNAL" name="user_type" type="VARCHAR(255)"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="user_creation_time" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="valid_to" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="description" type="VARCHAR(256)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-5">
        <createTable tableName="configuration">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="configuration_pkey"/>
            </column>
            <column name="c_key" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="c_value" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(2048)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-6">
        <createTable tableName="b_transaction">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="b_transaction_pkey"/>
            </column>
            <column name="gtw_tx_id" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="reservation_id" type="CHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="t_timestamp" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="currency" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_proxy" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="gtw_payment_id" type="VARCHAR(2048)"/>
            <column defaultValueNumeric="0" name="plat_fee" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="gtw_fee" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="COMPLETE" name="status" type="CHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="metadata" type="JSONB"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-7">
        <createTable tableName="j_user_organization">
            <column name="user_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="org_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-8">
        <createTable tableName="tickets_reservation">
            <column name="id" type="CHAR(36)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="tickets_reservation_pkey"/>
            </column>
            <column name="validity" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="full_name" type="VARCHAR(255)"/>
            <column name="email_address" type="VARCHAR(255)"/>
            <column name="billing_address" type="VARCHAR(4096)"/>
            <column name="confirmation_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="payment_method" type="VARCHAR(255)"/>
            <column defaultValueBoolean="false" name="offline_payment_reminder_sent" type="BOOLEAN"/>
            <column name="promo_code_id_fk" type="INTEGER"/>
            <column name="latest_reminder_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column defaultValueBoolean="false" name="automatic" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="user_language" type="VARCHAR(10)"/>
            <column defaultValueBoolean="false" name="direct_assignment" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="first_name" type="VARCHAR(255)"/>
            <column name="last_name" type="VARCHAR(255)"/>
            <column name="invoice_number" type="VARCHAR(256)"/>
            <column name="invoice_model" type="TEXT"/>
            <column name="event_id_fk" type="INTEGER"/>
            <column name="vat_status" type="VARCHAR(50)"/>
            <column name="vat_nr" type="VARCHAR(255)"/>
            <column name="vat_country" type="VARCHAR(2)"/>
            <column defaultValueBoolean="false" name="invoice_requested" type="BOOLEAN"/>
            <column name="used_vat_percent" type="numeric(5, 2)"/>
            <column name="vat_included" type="BOOLEAN"/>
            <column name="creation_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="customer_reference" type="VARCHAR(512)"/>
            <column name="billing_address_company" type="VARCHAR(512)"/>
            <column name="billing_address_line1" type="VARCHAR(512)"/>
            <column name="billing_address_line2" type="VARCHAR(512)"/>
            <column name="billing_address_zip" type="VARCHAR(512)"/>
            <column name="billing_address_city" type="VARCHAR(512)"/>
            <column name="validated_for_overview" type="BOOLEAN"/>
            <column name="skip_vat_nr" type="BOOLEAN"/>
            <column name="invoicing_additional_information" type="JSONB"/>
            <column name="registration_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="add_company_billing_details" type="BOOLEAN"/>
            <column defaultValueNumeric="0" name="src_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="final_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="vat_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="discount_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="currency_code" type="VARCHAR(3)"/>
            <column name="billing_address_state" type="TEXT"/>
            <column name="subscription_id_fk" type="UUID"/>
            <column name="user_id_fk" type="INTEGER"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-9">
        <createTable tableName="promo_code">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="promo_code_pkey"/>
            </column>
            <column name="promo_code" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="event_id_fk" type="INTEGER"/>
            <column name="valid_from" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="valid_to" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="discount_amount" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="discount_type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="categories" type="TEXT"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="max_usage" type="INTEGER"/>
            <column name="description" type="VARCHAR(1024)"/>
            <column name="email_reference" type="VARCHAR(256)"/>
            <column defaultValue="DISCOUNT" name="code_type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="hidden_category_id" type="INTEGER"/>
            <column name="currency_code" type="VARCHAR(3)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-10">
        <createTable tableName="email_message">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="email_message_pkey"/>
            </column>
            <column name="event_id" type="INTEGER"/>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="recipient" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="subject" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="message" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="attachments" type="TEXT"/>
            <column name="checksum" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="request_ts" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="sent_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column defaultValueNumeric="0" name="attempts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="email_cc" type="TEXT"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="reservation_id" type="CHAR(36)"/>
            <column name="html_message" type="TEXT"/>
            <column name="subscription_descriptor_id_fk" type="UUID"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-11">
        <createTable tableName="file_blob">
            <column name="id" type="CHAR(64)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="file_blob_pkey"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="content_size" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="content" type="BYTEA">
                <constraints nullable="false"/>
            </column>
            <column name="content_type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="creation_time" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="attributes" type="TEXT"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-12">
        <createTable tableName="waiting_queue">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="waiting_queue_pkey"/>
            </column>
            <column name="creation" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="event_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="full_name" type="VARCHAR(255)"/>
            <column name="email_address" type="VARCHAR(255)"/>
            <column name="ticket_reservation_id" type="VARCHAR(255)"/>
            <column name="user_language" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="subscription_type" type="VARCHAR(20)"/>
            <column name="selected_category_id" type="INTEGER"/>
            <column name="first_name" type="VARCHAR(255)"/>
            <column name="last_name" type="VARCHAR(255)"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-13">
        <createTable tableName="configuration_organization">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="configuration_organization_pkey"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="c_key" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="c_value" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(2048)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-14">
        <createTable tableName="configuration_event">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="configuration_event_pkey"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="c_key" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="c_value" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(2048)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-15">
        <createTable tableName="configuration_ticket_category">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="configuration_ticket_category_pkey"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="ticket_category_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="c_key" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="c_value" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(2048)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-16">
        <createTable tableName="event_migration">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="event_migration_pkey"/>
            </column>
            <column name="event_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="current_version" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="build_ts" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-17">
        <createTable tableName="ticket_field_configuration">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ticket_field_configuration_pkey"/>
            </column>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="field_name" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="field_order" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="field_type" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="field_restricted_values" type="TEXT"/>
            <column name="field_maxlength" type="INTEGER"/>
            <column name="field_minlength" type="INTEGER"/>
            <column name="field_required" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="ATTENDEE" name="context" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="-1" name="additional_service_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="ticket_category_ids" type="VARCHAR(1024)"/>
            <column name="field_disabled_values" type="VARCHAR(1024)"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="true" name="field_editable" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-18">
        <createTable tableName="sponsor_scan">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="sponsor_scan_pkey"/>
            </column>
            <column name="creation" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="event_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="ticket_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="user_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="notes" type="TEXT"/>
            <column defaultValue="WARM" name="lead_status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-19">
        <createTable tableName="dynamic_field_template">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="dynamic_field_template_pkey"/>
            </column>
            <column name="field_name" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="field_type" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="field_restricted_values" type="TEXT"/>
            <column name="field_description" type="TEXT"/>
            <column name="field_maxlength" type="INTEGER"/>
            <column name="field_minlength" type="INTEGER"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-20">
        <createTable tableName="additional_service">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="additional_service_pkey"/>
            </column>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="price_cts" type="INTEGER"/>
            <column name="fix_price" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="ordinal" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="-1" name="available_qty" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="-1" name="max_qty_per_order" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="inception_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="expiration_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="vat" type="numeric(5, 2)"/>
            <column name="vat_type" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="src_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="service_type" type="VARCHAR(255)"/>
            <column name="supplement_policy" type="VARCHAR(255)"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-21">
        <createTable tableName="additional_service_item">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="additional_service_item_pkey"/>
            </column>
            <column name="uuid" type="CHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="creation" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="tickets_reservation_uuid" type="CHAR(36)"/>
            <column name="additional_service_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="original_price_cts" type="INTEGER"/>
            <column name="paid_price_cts" type="INTEGER"/>
            <column name="status" type="VARCHAR(20)"/>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="src_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="final_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="vat_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="discount_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="currency_code" type="VARCHAR(10)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-22">
        <createTable tableName="additional_service_description">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="additional_service_description_pkey"/>
            </column>
            <column name="additional_service_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="locale" type="VARCHAR(8)">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(16)">
                <constraints nullable="false"/>
            </column>
            <column name="value" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-23">
        <createTable tableName="resource_global">
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="resource_global_pkey"/>
            </column>
            <column name="content_size" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="content" type="BYTEA">
                <constraints nullable="false"/>
            </column>
            <column name="content_type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="creation_time" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="attributes" type="TEXT"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-24">
        <createTable tableName="resource_organizer">
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="content_size" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="content" type="BYTEA">
                <constraints nullable="false"/>
            </column>
            <column name="content_type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="creation_time" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="attributes" type="TEXT"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-25">
        <createTable tableName="resource_event">
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="content_size" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="content" type="BYTEA">
                <constraints nullable="false"/>
            </column>
            <column name="content_type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="creation_time" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="attributes" type="TEXT"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-26">
        <createTable tableName="auditing">
            <column name="reservation_id" type="VARCHAR(512)"/>
            <column name="user_id" type="INTEGER"/>
            <column name="event_type" type="VARCHAR(128)"/>
            <column name="event_time" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="entity_type" type="VARCHAR(64)"/>
            <column name="entity_id" type="VARCHAR(512)"/>
            <column name="modifications" type="TEXT"/>
            <column name="event_id" type="INTEGER"/>
            <column name="organization_id_fk" type="INTEGER"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-27">
        <createTable tableName="spring_session">
            <column name="session_id" type="CHAR(36)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="spring_session_pk"/>
            </column>
            <column name="creation_time" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="last_access_time" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="max_inactive_interval" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="principal_name" type="VARCHAR(100)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-28">
        <createTable tableName="spring_session_attributes">
            <column name="session_id" type="CHAR(36)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="spring_session_attributes_pk"/>
            </column>
            <column name="attribute_name" type="VARCHAR(200)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="spring_session_attributes_pk"/>
            </column>
            <column name="attribute_bytes" type="BYTEA">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-29">
        <createTable tableName="admin_reservation_request">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="admin_reservation_request_pkey"/>
            </column>
            <column name="request_id" type="VARCHAR(512)">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="event_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="reservation_id" type="VARCHAR(512)"/>
            <column name="request_type" type="VARCHAR(64)"/>
            <column name="status" type="VARCHAR(64)"/>
            <column name="body" type="TEXT"/>
            <column name="failure_code" type="VARCHAR(255)"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-30">
        <createTable tableName="extension_configuration_metadata">
            <column autoIncrement="true" name="ecm_id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="extension_configuration_metadata_pkey"/>
            </column>
            <column name="ecm_name" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="ecm_configuration_level" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="ecm_description" type="VARCHAR(1024)"/>
            <column name="ecm_type" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="ecm_mandatory" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="ecm_es_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-31">
        <createTable tableName="extension_support">
            <column name="path" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="hash" type="VARCHAR(256)">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="async" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="script" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column autoIncrement="true" name="es_id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="extension_support_pkey"/>
            </column>
            <column defaultValue="" name="display_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="{}" name="metadata" type="JSONB">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-32">
        <createTable tableName="extension_log">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="extension_log_pkey"/>
            </column>
            <column name="path" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="effective_path" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(255)"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="event_ts" type="TIMESTAMP WITHOUT TIME ZONE"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-33">
        <createTable tableName="a_group">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="a_group_pkey"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(2048)"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="true" name="active" type="BOOLEAN"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-34">
        <createTable tableName="group_member">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="group_member_pkey"/>
            </column>
            <column name="a_group_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="value" type="VARCHAR(255)"/>
            <column name="description" type="VARCHAR(2048)"/>
            <column defaultValueBoolean="true" name="active" type="BOOLEAN"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-35">
        <createTable tableName="group_link">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="group_link_pkey"/>
            </column>
            <column name="a_group_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="ticket_category_id_fk" type="INTEGER"/>
            <column name="type" type="VARCHAR(255)"/>
            <column name="match_type" type="VARCHAR(255)"/>
            <column name="max_allocation" type="INTEGER"/>
            <column defaultValueBoolean="true" name="active" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-36">
        <createTable tableName="billing_document">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="billing_document_pkey"/>
            </column>
            <column name="event_id_fk" type="INTEGER"/>
            <column name="number" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="reservation_id_fk" type="CHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="model" type="TEXT"/>
            <column name="generation_ts" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="external_id" type="VARCHAR(255)"/>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-37">
        <createTable tableName="scan_audit">
            <column name="ticket_uuid" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="scan_ts" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="username" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="check_in_status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="operation" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-38">
        <createTable tableName="event_description_text">
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="event_description_text_pkey"/>
            </column>
            <column name="locale" type="VARCHAR(8)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="event_description_text_pkey"/>
            </column>
            <column name="type" type="VARCHAR(16)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="event_description_text_pkey"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-39">
        <createTable tableName="ticket_field_description">
            <column name="ticket_field_configuration_id_fk" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ticket_field_description_pkey"/>
            </column>
            <column name="field_locale" type="VARCHAR(8)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ticket_field_description_pkey"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-40">
        <createTable tableName="ticket_field_value">
            <column name="ticket_id_fk" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ticket_field_value_pkey"/>
            </column>
            <column name="ticket_field_configuration_id_fk" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ticket_field_value_pkey"/>
            </column>
            <column name="field_value" type="VARCHAR(2048)"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-41">
        <createTable tableName="ticket_category_text">
            <column name="ticket_category_id_fk" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ticket_category_text_pkey"/>
            </column>
            <column name="locale" type="VARCHAR(8)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ticket_category_text_pkey"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-42">
        <createTable tableName="whitelisted_ticket">
            <column name="group_member_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="group_link_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="ticket_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="requires_unique_value" type="BOOLEAN"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-43">
        <createTable tableName="admin_job_queue">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="admin_job_queue_pkey"/>
            </column>
            <column name="job_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="request_ts" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="execution_ts" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="metadata" type="JSONB"/>
            <column defaultValueNumeric="1" name="attempts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-44">
        <createTable tableName="poll_option">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="poll_option_pkey"/>
            </column>
            <column name="poll_id_fk" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="title" type="JSONB">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="JSONB"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-45">
        <createTable tableName="poll_answer">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="poll_answer_pkey"/>
            </column>
            <column name="poll_id_fk" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="poll_option_id_fk" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="ticket_id_fk" type="INTEGER"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-46">
        <createTable tableName="subscription_event">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="subscription_event_pkey"/>
            </column>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="subscription_descriptor_id_fk" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="price_per_ticket" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-47">
        <createTable tableName="user_profile">
            <column name="user_id_fk" type="INTEGER"/>
            <column name="billing_address_company" type="TEXT"/>
            <column name="billing_address_line1" type="TEXT"/>
            <column name="billing_address_line2" type="TEXT"/>
            <column name="billing_address_zip" type="TEXT"/>
            <column name="billing_address_city" type="TEXT"/>
            <column name="billing_address_state" type="TEXT"/>
            <column name="vat_country" type="TEXT"/>
            <column name="vat_nr" type="TEXT"/>
            <column name="invoicing_additional_information" type="JSONB"/>
            <column defaultValueComputed="{}" name="additional_fields" type="JSONB">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-48">
        <createTable tableName="extension_configuration_metadata_value">
            <column name="fk_ecm_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="conf_path" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="conf_value" type="VARCHAR(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-49">
        <createTable tableName="extension_event">
            <column name="es_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="event" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-50">
        <createIndex indexName="flyway_schema_history_s_idx" tableName="flyway_schema_history">
            <column name="success"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-51">
        <addUniqueConstraint columnNames="code" constraintName="unique_code" tableName="special_price"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-52">
        <addUniqueConstraint columnNames="name" constraintName="unique_org_name" tableName="organization"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-53">
        <addUniqueConstraint columnNames="slug" constraintName="unique_org_slug" tableName="organization"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-54">
        <createView fullDefinition="false" viewName="auditing_user">SELECT auditing.reservation_id,
                                                                           auditing.user_id,
                                                                           auditing.event_type,
                                                                           auditing.event_time,
                                                                           auditing.entity_type,
                                                                           auditing.entity_id,
                                                                           auditing.modifications,
                                                                           ba_user.id,
                                                                           ba_user.username,
                                                                           ba_user.password,
                                                                           ba_user.first_name,
                                                                           ba_user.last_name,
                                                                           ba_user.email_address,
                                                                           ba_user.enabled
                                                                    FROM (auditing
                                                                        LEFT JOIN ba_user ON ((auditing.user_id = ba_user.id)));</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-55">
        <addUniqueConstraint columnNames="username" constraintName="unique_username" tableName="ba_user"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-56">
        <createTable tableName="event">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="event_pkey"/>
            </column>
            <column name="short_name" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="VARCHAR(2048)"/>
            <column name="latitude" type="VARCHAR(255)"/>
            <column name="longitude" type="VARCHAR(255)"/>
            <column name="start_ts" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="end_ts" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="time_zone" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="regular_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="currency" type="VARCHAR(3)"/>
            <column name="available_seats" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="vat_included" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="vat" type="numeric(5, 2)">
                <constraints nullable="false"/>
            </column>
            <column name="allowed_payment_proxies" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="private_key" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="org_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="website_url" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="website_t_c_url" type="VARCHAR(2048)">
                <constraints nullable="false"/>
            </column>
            <column name="image_url" type="VARCHAR(2048)"/>
            <column name="file_blob_id" type="CHAR(64)"/>
            <column name="display_name" type="VARCHAR(255)"/>
            <column defaultValueNumeric="7" name="locales" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="INTERNAL" name="type" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="external_url" type="VARCHAR(1024)"/>
            <column defaultValueNumeric="0" name="src_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="NONE" name="vat_status" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="VARCHAR(50)"/>
            <column defaultValue="PUBLIC" name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="website_p_p_url" type="VARCHAR(2048)"/>
            <column defaultValue="IN_PERSON" name="format" type="EVENT_FORMAT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="{}" name="metadata" type="JSONB">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="ARRAY[]::text[]" name="tags" type="TEXT[]">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-57">
        <addUniqueConstraint columnNames="c_key" constraintName="unique_configuration_c_key" tableName="configuration"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-58">
        <createIndex indexName="b_transaction_reservation_id_idx" tableName="b_transaction">
            <column name="reservation_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-59">
        <createIndex indexName="j_user_organization_user_id_idx" tableName="j_user_organization">
            <column name="user_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-60">
        <createIndex indexName="j_user_organization_org_id_idx" tableName="j_user_organization">
            <column name="org_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-61">
        <createIndex indexName="tickets_reservation_promo_code_id_fk_idx" tableName="tickets_reservation">
            <column name="promo_code_id_fk"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-62">
        <createIndex indexName="idx_reservation_subscription_id_fk" tableName="tickets_reservation">
            <column computed="true" name="(subscription_id_fk IS NOT NULL)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-63">
        <createIndex indexName="idx_reservation_user_id" tableName="tickets_reservation">
            <column computed="true" name="(user_id_fk IS NOT NULL)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-64">
        <createIndex indexName="promo_code_event_id_fk_idx" tableName="promo_code">
            <column name="event_id_fk"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-65">
        <createIndex indexName="unique_promo_code_for_org" tableName="promo_code" unique="true">
            <column computed="true" name="(event_id_fk IS NULL)"/>
            <column computed="true" name="(event_id_fk IS NULL)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-66">
        <createIndex indexName="unique_promo_code_for_event" tableName="promo_code" unique="true">
            <column computed="true" name="(event_id_fk IS NOT NULL)"/>
            <column computed="true" name="(event_id_fk IS NOT NULL)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-67">
        <createIndex indexName="idx_email_msg_checksum" tableName="email_message">
            <column name="checksum"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-68">
        <createIndex indexName="idx_email_event_id" tableName="email_message">
            <column computed="true" name="(event_id IS NOT NULL)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-69">
        <createIndex indexName="idx_email_subscription_descriptor" tableName="email_message">
            <column computed="true" name="(subscription_descriptor_id_fk IS NOT NULL)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-70">
        <createIndex indexName="idx_email_subscription_status_process" tableName="email_message">
            <column computed="true" name="(((status)::text = 'WAITING'::text) OR ((status)::text = 'RETRY'::text))"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-71">
        <addUniqueConstraint columnNames="event_id, email_address" constraintName="wq_unique_email" tableName="waiting_queue"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-72">
        <addUniqueConstraint columnNames="organization_id_fk, c_key" constraintName="unique_configuration_organization" tableName="configuration_organization"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-73">
        <addUniqueConstraint columnNames="organization_id_fk, event_id_fk, c_key" constraintName="unique_configuration_event" tableName="configuration_event"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-74">
        <addUniqueConstraint columnNames="organization_id_fk, event_id_fk, ticket_category_id_fk, c_key" constraintName="unique_configuration_ticket_category" tableName="configuration_ticket_category"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-75">
        <addUniqueConstraint columnNames="event_id" constraintName="unique_event_id" tableName="event_migration"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-76">
        <addUniqueConstraint columnNames="event_id_fk, field_name, additional_service_id, context" constraintName="unique_ticket_field_configuration" tableName="ticket_field_configuration"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-77">
        <addUniqueConstraint columnNames="event_id, ticket_id, user_id" constraintName="spsc_unique_ticket" tableName="sponsor_scan"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-78">
        <addUniqueConstraint columnNames="field_name" constraintName="unique_dynamic_template_name" tableName="dynamic_field_template"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-79">
        <createView fullDefinition="false" viewName="additional_service_with_currency">SELECT asv.id,
                                                                                              asv.event_id_fk,
                                                                                              asv.price_cts,
                                                                                              asv.fix_price,
                                                                                              asv.ordinal,
                                                                                              asv.available_qty,
                                                                                              asv.max_qty_per_order,
                                                                                              asv.inception_ts,
                                                                                              asv.expiration_ts,
                                                                                              asv.vat,
                                                                                              asv.vat_type,
                                                                                              asv.src_price_cts,
                                                                                              asv.service_type,
                                                                                              asv.supplement_policy,
                                                                                              asv.organization_id_fk,
                                                                                              e.currency AS currency_code
                                                                                       FROM additional_service asv,
                                                                                            event e
                                                                                       WHERE (asv.event_id_fk = e.id);</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-80">
        <addUniqueConstraint columnNames="additional_service_id_fk, locale, type" constraintName="unique_asd" tableName="additional_service_description"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-81">
        <addUniqueConstraint columnNames="name, organization_id_fk" constraintName="unique_resource_organizer" tableName="resource_organizer"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-82">
        <addUniqueConstraint columnNames="name, organization_id_fk, event_id_fk" constraintName="unique_resource_event" tableName="resource_event"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-83">
        <createTable tableName="invoice_sequences">
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="invoice_sequences_pkey"/>
            </column>
            <column name="invoice_sequence" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="INVOICE" name="document_type" type="BILLING_DOCUMENT_TYPE">
                <constraints nullable="false" primaryKey="true" primaryKeyName="invoice_sequences_pkey"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-84">
        <createIndex indexName="auditing_reservation_id_idx" tableName="auditing">
            <column name="reservation_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-85">
        <createIndex indexName="auditing_event_id_idx" tableName="auditing">
            <column name="event_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-86">
        <createView fullDefinition="false" viewName="latest_ticket_update">SELECT (auditing.entity_id)::integer AS ticket_id,
                                                                             auditing.event_id,
                                                                                  max(auditing.event_time) AS last_update
                                                                           FROM auditing
                                                                           WHERE ((auditing.entity_type)::text = 'TICKET'::text)
                                                                           GROUP BY (auditing.entity_id)::integer, auditing.event_id;</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-87">
        <createIndex indexName="spring_session_ix1" tableName="spring_session">
            <column name="last_access_time"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-88">
        <createIndex indexName="spring_session_attributes_ix1" tableName="spring_session_attributes">
            <column name="session_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-89">
        <createIndex indexName="admin_reservation_request_req_idx" tableName="admin_reservation_request">
            <column name="request_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-90">
        <createIndex indexName="admin_reservation_request_res_idx" tableName="admin_reservation_request">
            <column name="reservation_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-91">
        <createIndex indexName="admin_reservation_request_sts_idx" tableName="admin_reservation_request">
            <column name="status"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-92">
        <createView fullDefinition="false" viewName="admin_reservation_request_stats">SELECT admin_reservation_request.request_id,
                                                                                             admin_reservation_request.user_id,
                                                                                             admin_reservation_request.event_id,
                                                                                             sum(
                                                                                               CASE ((admin_reservation_request.status)::text = 'PENDING'::text)
            WHEN true THEN 1
            ELSE 0
        END) AS count_pending,
                                                                                             sum(
                                                                                               CASE ((admin_reservation_request.status)::text = 'SUCCESS'::text)
            WHEN true THEN 1
            ELSE 0
        END) AS count_success,
                                                                                             sum(
                                                                                               CASE ((admin_reservation_request.status)::text = 'ERROR'::text)
            WHEN true THEN 1
            ELSE 0
        END) AS count_error
                                                                                      FROM admin_reservation_request
                                                                                      GROUP BY admin_reservation_request.request_id, admin_reservation_request.event_id, admin_reservation_request.user_id;</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-93">
        <addUniqueConstraint columnNames="ecm_es_id_fk, ecm_name, ecm_configuration_level" constraintName="unique_extension_configuration_metadata" tableName="extension_configuration_metadata"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-94">
        <createView fullDefinition="false" viewName="extension_capabilities">SELECT es.es_id,
                                                                                    es.path,
                                                                                    es.name,
                                                                                    es.hash,
                                                                                    es.enabled,
                                                                                    es.async,
                                                                                    es.script,
                                                                                    es.display_name,
                                                                                    cap.value AS capability,
                                                                                    ev.events,
                                                                                    ( SELECT jsonb_agg(capd.value) AS jsonb_agg
                                                                                      FROM jsonb_array_elements((es.metadata -&gt; 'capabilityDetails'::text)) capd(value)
                                                                                      WHERE ((jsonb_typeof((es.metadata -&gt; 'capabilityDetails'::text)) = 'array'::text) AND ((capd.value IS NULL) OR (capd.value @&gt; ((('{"key": "'::text || cap.value) || '"}'::text))::jsonb)))) AS capability_detail
                                                                             FROM (extension_support es
                                                                                 CROSS JOIN LATERAL ( SELECT cap_1.value
                                                                                 FROM jsonb_array_elements_text((es.metadata -&gt; 'capabilities'::text)) cap_1(value)
                                                                                 WHERE (jsonb_typeof((es.metadata -&gt; 'capabilities'::text)) = 'array'::text)) cap),
                                                                                 LATERAL ( SELECT jsonb_agg(jsonb_array_elements_text.value) AS events
                                                                                 FROM jsonb_array_elements_text((es.metadata -&gt; 'events'::text)) jsonb_array_elements_text(value)
                                                                                 WHERE (jsonb_typeof((es.metadata -&gt; 'events'::text)) = 'array'::text)) ev
                                                                             WHERE ((es.enabled = true) AND (es.metadata IS NOT NULL));</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-95">
        <addUniqueConstraint columnNames="path, name" constraintName="unique_extension_support" tableName="extension_support"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-96">
        <createView fullDefinition="false" viewName="group_active">SELECT a_group.id,
                                                                          a_group.name,
                                                                          a_group.description,
                                                                          a_group.organization_id_fk,
                                                                          a_group.active
                                                                   FROM a_group
                                                                   WHERE (a_group.active = true);</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-97">
        <addUniqueConstraint columnNames="name, organization_id_fk" constraintName="a_group_unique_name_org_id" tableName="a_group"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-98">
        <createView fullDefinition="false" viewName="group_member_active">SELECT group_member.id,
                                                                                 group_member.a_group_id_fk,
                                                                                 group_member.value,
                                                                                 group_member.description,
                                                                                 group_member.active
                                                                          FROM group_member
                                                                          WHERE (group_member.active = true);</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-99">
        <addUniqueConstraint columnNames="a_group_id_fk, value" constraintName="group_member_unique_value" tableName="group_member"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-100">
        <createView fullDefinition="false" viewName="group_link_active">SELECT group_link.id,
                                                                               group_link.a_group_id_fk,
                                                                               group_link.event_id_fk,
                                                                               group_link.ticket_category_id_fk,
                                                                               group_link.type,
                                                                               group_link.match_type,
                                                                               group_link.max_allocation,
                                                                               group_link.active
                                                                        FROM group_link
                                                                        WHERE (group_link.active = true);</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-101">
        <createIndex indexName="ticket_field_value_configuration" tableName="ticket_field_value">
            <column name="ticket_field_configuration_id_fk"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-102">
        <addUniqueConstraint columnNames="group_member_id_fk, group_link_id_fk, requires_unique_value" constraintName="whitelisted_ticket_unique_item_id" tableName="whitelisted_ticket"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-103">
        <createIndex indexName="unique_job_schedule" tableName="admin_job_queue">
            <column computed="true" name="((job_name)::text &lt;&gt; 'EXECUTE_EXTENSION'::text)"/>
            <column computed="true" name="((job_name)::text &lt;&gt; 'EXECUTE_EXTENSION'::text)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-104">
        <createTable tableName="poll">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="poll_pkey"/>
            </column>
            <column defaultValue="DRAFT" name="status" type="POLL_STATUS">
                <constraints nullable="false"/>
            </column>
            <column name="title" type="JSONB">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="JSONB"/>
            <column defaultValueComputed="ARRAY[]::text[]" name="allowed_tags" type="TEXT[]">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="poll_order" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="event_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-105">
        <addUniqueConstraint columnNames="poll_id_fk, ticket_id_fk" constraintName="unique_answer_poll_ticket" tableName="poll_answer"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-106">
        <createTable tableName="subscription">
            <column name="id" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="subscription_pkey"/>
            </column>
            <column name="first_name" type="TEXT"/>
            <column name="last_name" type="TEXT"/>
            <column name="email_address" type="TEXT"/>
            <column name="subscription_descriptor_fk" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="reservation_id_fk" type="CHAR(36)"/>
            <column name="max_usage" type="INTEGER"/>
            <column defaultValueComputed="now()" name="valid_from" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="valid_to" type="TIMESTAMP WITH TIME ZONE"/>
            <column defaultValueNumeric="0" name="src_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="final_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="vat_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="discount_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="currency" type="TEXT"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="creation_ts" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="update_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column defaultValue="FREE" name="status" type="ALLOCATION_STATUS">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="-1" name="max_entries" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="validity_from" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="validity_to" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="confirmation_ts" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="time_zone" type="TEXT"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-107">
        <createView fullDefinition="false" viewName="reservation_and_subscription_and_tx">SELECT tickets_reservation.id AS tr_id,
                                                                                                 tickets_reservation.validity AS tr_validity,
                                                                                                 tickets_reservation.status AS tr_status,
                                                                                                 tickets_reservation.full_name AS tr_full_name,
                                                                                                 tickets_reservation.first_name AS tr_first_name,
                                                                                                 tickets_reservation.last_name AS tr_last_name,
                                                                                                 tickets_reservation.email_address AS tr_email_address,
                                                                                                 tickets_reservation.billing_address AS tr_billing_address,
                                                                                                 tickets_reservation.confirmation_ts AS tr_confirmation_ts,
                                                                                                 tickets_reservation.latest_reminder_ts AS tr_latest_reminder_ts,
                                                                                                 tickets_reservation.payment_method AS tr_payment_method,
                                                                                                 tickets_reservation.offline_payment_reminder_sent AS tr_offline_payment_reminder_sent,
                                                                                                 tickets_reservation.promo_code_id_fk AS tr_promo_code_id_fk,
                                                                                                 tickets_reservation.automatic AS tr_automatic,
                                                                                                 tickets_reservation.user_language AS tr_user_language,
                                                                                                 tickets_reservation.direct_assignment AS tr_direct_assignment,
                                                                                                 tickets_reservation.invoice_number AS tr_invoice_number,
                                                                                                 tickets_reservation.invoice_model AS tr_invoice_model,
                                                                                                 tickets_reservation.vat_status AS tr_vat_status,
                                                                                                 tickets_reservation.vat_nr AS tr_vat_nr,
                                                                                                 tickets_reservation.vat_country AS tr_vat_country,
                                                                                                 tickets_reservation.invoice_requested AS tr_invoice_requested,
                                                                                                 tickets_reservation.used_vat_percent AS tr_used_vat_percent,
                                                                                                 tickets_reservation.vat_included AS tr_vat_included,
                                                                                                 tickets_reservation.creation_ts AS tr_creation_ts,
                                                                                                 tickets_reservation.customer_reference AS tr_customer_reference,
                                                                                                 tickets_reservation.billing_address_company AS tr_billing_address_company,
                                                                                                 tickets_reservation.billing_address_line1 AS tr_billing_address_line1,
                                                                                                 tickets_reservation.billing_address_line2 AS tr_billing_address_line2,
                                                                                                 tickets_reservation.billing_address_city AS tr_billing_address_city,
                                                                                                 tickets_reservation.billing_address_zip AS tr_billing_address_zip,
                                                                                                 tickets_reservation.registration_ts AS tr_registration_ts,
                                                                                                 tickets_reservation.invoicing_additional_information AS tr_invoicing_additional_information,
                                                                                                 tickets_reservation.src_price_cts AS tr_src_price_cts,
                                                                                                 tickets_reservation.final_price_cts AS tr_final_price_cts,
                                                                                                 tickets_reservation.vat_cts AS tr_vat_cts,
                                                                                                 tickets_reservation.discount_cts AS tr_discount_cts,
                                                                                                 tickets_reservation.currency_code AS tr_currency_code,
                                                                                                 subscription.id AS s_id,
                                                                                                 subscription.first_name AS s_first_name,
                                                                                                 subscription.last_name AS s_last_name,
                                                                                                 subscription.email_address AS s_email_address,
                                                                                                 ( SELECT count(*) AS count
                                                                                          FROM tickets_reservation tr
                                                                                          WHERE (tr.subscription_id_fk = subscription.id)) AS s_usage_count,
                                                                                              subscription.max_usage AS s_max_usage,
                                                                                              subscription.valid_from AS s_valid_from,
                                                                                              subscription.valid_to AS s_valid_to,
                                                                                              subscription.src_price_cts AS s_src_price_cts,
                                                                                              subscription.final_price_cts AS s_final_price_cts,
                                                                                              subscription.vat_cts AS s_vat_cts,
                                                                                              subscription.discount_cts AS s_discount_cts,
                                                                                              subscription.currency AS s_currency,
                                                                                              subscription.organization_id_fk AS s_organization_id,
                                                                                              subscription.creation_ts AS s_creation_ts,
                                                                                              subscription.update_ts AS s_update_ts,
                                                                                              subscription.status AS s_status,
                                                                                              subscription.subscription_descriptor_fk AS s_descriptor_id,
                                                                                              b_transaction.id AS bt_id,
                                                                                              b_transaction.gtw_tx_id AS bt_gtw_tx_id,
                                                                                              b_transaction.gtw_payment_id AS bt_gtw_payment_id,
                                                                                              b_transaction.reservation_id AS bt_reservation_id,
                                                                                              b_transaction.t_timestamp AS bt_t_timestamp,
                                                                                              b_transaction.price_cts AS bt_price_cts,
                                                                                              b_transaction.currency AS bt_currency,
                                                                                              b_transaction.description AS bt_description,
                                                                                              b_transaction.payment_proxy AS bt_payment_proxy,
                                                                                              b_transaction.gtw_fee AS bt_gtw_fee,
                                                                                              b_transaction.plat_fee AS bt_plat_fee,
                                                                                              b_transaction.status AS bt_status,
                                                                                              b_transaction.metadata AS bt_metadata,
                                                                                              promo_code.promo_code
                                                                                          FROM (((tickets_reservation
                                                                                              JOIN subscription ON ((subscription.reservation_id_fk = tickets_reservation.id)))
                                                                                              LEFT JOIN b_transaction ON (((tickets_reservation.id = b_transaction.reservation_id) AND (b_transaction.status &lt;&gt; 'INVALID'::bpchar))))
                                                                                              LEFT JOIN promo_code ON ((tickets_reservation.promo_code_id_fk = promo_code.id)));</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-108">
        <addUniqueConstraint columnNames="subscription_descriptor_id_fk, event_id_fk" constraintName="unique_subscription_event" tableName="subscription_event"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-109">
        <addUniqueConstraint columnNames="user_id_fk" constraintName="user_profile_user_id_unique" tableName="user_profile"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-110">
        <addUniqueConstraint columnNames="fk_ecm_id, conf_path" constraintName="unique_extension_configuration_metadata_value" tableName="extension_configuration_metadata_value"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-111">
        <addUniqueConstraint columnNames="es_id_fk, event" constraintName="unique_extension_event" tableName="extension_event"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-112">
        <createIndex indexName="event_org_id_idx" tableName="event">
            <column name="org_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-113">
        <addUniqueConstraint columnNames="short_name" constraintName="unique_event_name" tableName="event"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-114">
        <addUniqueConstraint columnNames="private_key" constraintName="unique_private_key" tableName="event"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-115">
        <createTable tableName="subscription_descriptor">
            <column name="id" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="subscription_descriptor_pkey"/>
            </column>
            <column name="title" type="JSONB">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="JSONB"/>
            <column defaultValueNumeric="-1" name="max_available" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="now()" name="creation_ts" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="on_sale_from" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="on_sale_to" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="vat" type="numeric(5, 2)">
                <constraints nullable="false"/>
            </column>
            <column name="vat_status" type="VAT_STATUS">
                <constraints nullable="false"/>
            </column>
            <column name="currency" type="TEXT"/>
            <column defaultValueBoolean="false" name="is_public" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="-1" name="max_entries" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="validity_type" type="SUBSCRIPTION_VALIDITY_TYPE">
                <constraints nullable="false"/>
            </column>
            <column name="validity_time_unit" type="SUBSCRIPTION_TIME_UNIT"/>
            <column name="validity_units" type="INTEGER"/>
            <column name="validity_from" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="validity_to" type="TIMESTAMP WITH TIME ZONE"/>
            <column defaultValue="ONCE_PER_EVENT" name="usage_type" type="SUBSCRIPTION_USAGE_TYPE">
                <constraints nullable="false"/>
            </column>
            <column name="terms_conditions_url" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="privacy_policy_url" type="TEXT"/>
            <column name="file_blob_id_fk" type="CHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="allowed_payment_proxies" type="TEXT[]">
                <constraints nullable="false"/>
            </column>
            <column name="private_key" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="time_zone" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="false" name="supports_tickets_generation" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-116">
        <createView fullDefinition="false" viewName="subscription_descriptor_statistics">SELECT sd.id AS sd_id,
                                                                                                sd.title AS sd_title,
                                                                                                sd.description AS sd_description,
                                                                                                sd.max_available AS sd_max_available,
                                                                                                sd.creation_ts AS sd_creation_ts,
                                                                                                sd.on_sale_from AS sd_on_sale_from,
                                                                                                sd.on_sale_to AS sd_on_sale_to,
                                                                                                sd.price_cts AS sd_price_cts,
                                                                                                sd.vat AS sd_vat,
                                                                                                sd.vat_status AS sd_vat_status,
                                                                                                sd.currency AS sd_currency,
                                                                                                sd.is_public AS sd_is_public,
                                                                                                sd.organization_id_fk AS sd_organization_id_fk,
                                                                                                sd.max_entries AS sd_max_entries,
                                                                                                sd.validity_type AS sd_validity_type,
                                                                                                sd.validity_time_unit AS sd_validity_time_unit,
                                                                                                sd.validity_units AS sd_validity_units,
                                                                                                sd.validity_from AS sd_validity_from,
                                                                                                sd.validity_to AS sd_validity_to,
                                                                                                sd.usage_type AS sd_usage_type,
                                                                                                sd.terms_conditions_url AS sd_terms_conditions_url,
                                                                                                sd.privacy_policy_url AS sd_privacy_policy_url,
                                                                                                sd.file_blob_id_fk AS sd_file_blob_id_fk,
                                                                                                sd.allowed_payment_proxies AS sd_allowed_payment_proxies,
                                                                                                sd.private_key AS sd_private_key,
                                                                                                sd.time_zone AS sd_time_zone,
                                                                                                sd.supports_tickets_generation AS sd_supports_tickets_generation,
                                                                                                ( SELECT count(*) AS count
                                                                                         FROM reservation_and_subscription_and_tx
                                                                                         WHERE (reservation_and_subscription_and_tx.s_descriptor_id = sd.id)) AS s_reservations_count,
                                                                                             ( SELECT count(*) AS count
                                                                                         FROM subscription
                                                                                         WHERE (((subscription.status &gt;= 'ACQUIRED'::allocation_status) AND (subscription.status &lt;= 'CHECKED_IN'::allocation_status)) AND (subscription.subscription_descriptor_fk = sd.id))) AS s_sold_count,
                                                                                             ( SELECT count(*) AS count
                                                                                         FROM subscription
                                                                                         WHERE ((subscription.status = 'PENDING'::allocation_status) AND (subscription.subscription_descriptor_fk = sd.id))) AS s_pending_count,
                                                                                             ( SELECT count(*) AS count
                                                                                         FROM subscription_event
                                                                                         WHERE (subscription_event.subscription_descriptor_id_fk = sd.id)) AS s_events_count
                                                                                         FROM subscription_descriptor sd
                                                                                         ORDER BY sd.on_sale_from, sd.on_sale_to;</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-117">
        <createIndex indexName="subscription_partial_id_idx" tableName="subscription">
            <column computed="true" name="substring(replace((id)::text, '-'::text, ''::text), 0, 11)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-118">
        <createIndex indexName="idx_subscription_validity_to" tableName="subscription">
            <column computed="true" name="(validity_to IS NOT NULL)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-119">
        <createIndex indexName="idx_subscription_validity_from" tableName="subscription">
            <column computed="true" name="(validity_from IS NOT NULL)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-120">
        <createView fullDefinition="false" viewName="basic_event_with_optional_subscription">SELECT e.id,
                                                                                                    e.short_name,
                                                                                                    e.location,
                                                                                                    e.latitude,
                                                                                                    e.longitude,
                                                                                                    e.start_ts,
                                                                                                    e.end_ts,
                                                                                                    e.time_zone,
                                                                                                    e.regular_price_cts,
                                                                                                    e.currency,
                                                                                                    e.available_seats,
                                                                                                    e.vat_included,
                                                                                                    e.vat,
                                                                                                    e.allowed_payment_proxies,
                                                                                                    e.private_key,
                                                                                                    e.org_id,
                                                                                                    e.website_url,
                                                                                                    e.website_t_c_url,
                                                                                                    e.image_url,
                                                                                                    e.file_blob_id,
                                                                                                    e.display_name,
                                                                                                    e.locales,
                                                                                                    e.type,
                                                                                                    e.external_url,
                                                                                                    e.src_price_cts,
                                                                                                    e.vat_status,
                                                                                                    e.version,
                                                                                                    e.status,
                                                                                                    e.website_p_p_url,
                                                                                                    e.format,
                                                                                                    e.metadata,
                                                                                                    e.tags,
                                                                                                    s.id AS subscription_id,
                                                                                                    o.slug AS org_slug
                                                                                             FROM ((((event e
                                                                                                 LEFT JOIN subscription_event se ON ((se.event_id_fk = e.id)))
                                                                                                 LEFT JOIN subscription_descriptor sd ON ((se.subscription_descriptor_id_fk = sd.id)))
                                                                                                 LEFT JOIN subscription s ON ((sd.id = s.subscription_descriptor_fk)))
                                                                                                      LEFT JOIN organization o ON ((e.org_id = o.id)));</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-121">
        <createView fullDefinition="false" viewName="available_subscriptions_by_event">WITH usage_by_subscription_id AS (
            SELECT s_1.id AS subscription_id,
                   sum(
                     CASE
                         WHEN (t.subscription_id_fk IS NOT NULL) THEN 1
                         ELSE 0
                         END) AS usage
                                                                                       FROM (subscription s_1
                                                                                           LEFT JOIN tickets_reservation t ON ((t.subscription_id_fk = s_1.id)))
                                                                                       GROUP BY s_1.id
                                                                                           )
        SELECT e.id AS event_id,
               e.org_id AS organization_id,
               e.end_ts AS e_end_ts,
               s.id AS subscription_id,
               s.email_address,
               s.first_name,
               s.last_name,
               r.user_language,
               s.validity_from AS s_validity_from,
               s.valid_to AS s_validity_to
        FROM (((((event e
            JOIN subscription_event se ON ((se.event_id_fk = e.id)))
            JOIN subscription_descriptor sd ON ((se.subscription_descriptor_id_fk = sd.id)))
            JOIN subscription s ON ((sd.id = s.subscription_descriptor_fk)))
            JOIN usage_by_subscription_id u ON ((s.id = u.subscription_id)))
                 JOIN tickets_reservation r ON ((r.id = s.reservation_id_fk)))
        WHERE ((s.status = 'ACQUIRED'::allocation_status) AND (NOT (EXISTS ( SELECT tr.id
                                                                             FROM tickets_reservation tr
                                                                             WHERE ((tr.subscription_id_fk = s.id) AND (tr.event_id_fk = e.id))))) AND (sd.supports_tickets_generation IS TRUE) AND ((s.max_usage = '-1'::integer) OR (s.max_usage &gt; u.usage)))
        ORDER BY e.id;</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-122">
        <createTable tableName="ticket">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ticket_pkey"/>
            </column>
            <column name="uuid" type="CHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="creation" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="category_id" type="INTEGER"/>
            <column name="event_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="original_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="paid_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="tickets_reservation_id" type="CHAR(36)"/>
            <column name="full_name" type="VARCHAR(255)"/>
            <column name="email_address" type="VARCHAR(255)"/>
            <column name="special_price_id_fk" type="INTEGER"/>
            <column defaultValueBoolean="false" name="locked_assignment" type="BOOLEAN"/>
            <column name="user_language" type="VARCHAR(20)"/>
            <column defaultValueBoolean="false" name="reminder_sent" type="BOOLEAN"/>
            <column defaultValueNumeric="0" name="src_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="final_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="vat_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="discount_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="first_name" type="VARCHAR(255)"/>
            <column name="last_name" type="VARCHAR(255)"/>
            <column name="ext_reference" type="VARCHAR(255)"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="currency_code" type="VARCHAR(10)"/>
            <column defaultValueComputed="ARRAY[]::text[]" name="tags" type="TEXT[]">
                <constraints nullable="false"/>
            </column>
            <column name="subscription_id_fk" type="UUID"/>
            <column defaultValueComputed="{}" name="metadata" type="JSONB">
                <constraints nullable="false"/>
            </column>
            <column name="vat_status" type="VAT_STATUS"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-123">
        <createView fullDefinition="false" viewName="reservation_and_ticket_and_tx">SELECT tickets_reservation.id AS tr_id,
                                                                                           tickets_reservation.validity AS tr_validity,
                                                                                           tickets_reservation.status AS tr_status,
                                                                                           tickets_reservation.full_name AS tr_full_name,
                                                                                           tickets_reservation.first_name AS tr_first_name,
                                                                                           tickets_reservation.last_name AS tr_last_name,
                                                                                           tickets_reservation.email_address AS tr_email_address,
                                                                                           tickets_reservation.billing_address AS tr_billing_address,
                                                                                           tickets_reservation.confirmation_ts AS tr_confirmation_ts,
                                                                                           tickets_reservation.latest_reminder_ts AS tr_latest_reminder_ts,
                                                                                           tickets_reservation.payment_method AS tr_payment_method,
                                                                                           tickets_reservation.offline_payment_reminder_sent AS tr_offline_payment_reminder_sent,
                                                                                           tickets_reservation.promo_code_id_fk AS tr_promo_code_id_fk,
                                                                                           tickets_reservation.automatic AS tr_automatic,
                                                                                           tickets_reservation.user_language AS tr_user_language,
                                                                                           tickets_reservation.direct_assignment AS tr_direct_assignment,
                                                                                           tickets_reservation.invoice_number AS tr_invoice_number,
                                                                                           tickets_reservation.invoice_model AS tr_invoice_model,
                                                                                           tickets_reservation.vat_status AS tr_vat_status,
                                                                                           tickets_reservation.vat_nr AS tr_vat_nr,
                                                                                           tickets_reservation.vat_country AS tr_vat_country,
                                                                                           tickets_reservation.invoice_requested AS tr_invoice_requested,
                                                                                           tickets_reservation.used_vat_percent AS tr_used_vat_percent,
                                                                                           tickets_reservation.vat_included AS tr_vat_included,
                                                                                           tickets_reservation.event_id_fk AS tr_event_id,
                                                                                           tickets_reservation.creation_ts AS tr_creation_ts,
                                                                                           tickets_reservation.customer_reference AS tr_customer_reference,
                                                                                           tickets_reservation.billing_address_company AS tr_billing_address_company,
                                                                                           tickets_reservation.billing_address_line1 AS tr_billing_address_line1,
                                                                                           tickets_reservation.billing_address_line2 AS tr_billing_address_line2,
                                                                                           tickets_reservation.billing_address_city AS tr_billing_address_city,
                                                                                           tickets_reservation.billing_address_state AS tr_billing_address_state,
                                                                                           tickets_reservation.billing_address_zip AS tr_billing_address_zip,
                                                                                           tickets_reservation.registration_ts AS tr_registration_ts,
                                                                                           tickets_reservation.invoicing_additional_information AS tr_invoicing_additional_information,
                                                                                           tickets_reservation.src_price_cts AS tr_src_price_cts,
                                                                                           tickets_reservation.final_price_cts AS tr_final_price_cts,
                                                                                           tickets_reservation.vat_cts AS tr_vat_cts,
                                                                                           tickets_reservation.discount_cts AS tr_discount_cts,
                                                                                           tickets_reservation.currency_code AS tr_currency_code,
                                                                                           ticket.id AS t_id,
                                                                                           ticket.uuid AS t_uuid,
                                                                                           ticket.creation AS t_creation,
                                                                                           ticket.category_id AS t_category_id,
                                                                                           ticket.status AS t_status,
                                                                                           ticket.event_id AS t_event_id,
                                                                                           ticket.tickets_reservation_id AS t_tickets_reservation_id,
                                                                                           ticket.full_name AS t_full_name,
                                                                                           ticket.first_name AS t_first_name,
                                                                                           ticket.last_name AS t_last_name,
                                                                                           ticket.email_address AS t_email_address,
                                                                                           ticket.locked_assignment AS t_locked_assignment,
                                                                                           ticket.user_language AS t_user_language,
                                                                                           ticket.src_price_cts AS t_src_price_cts,
                                                                                           ticket.final_price_cts AS t_final_price_cts,
                                                                                           ticket.vat_cts AS t_vat_cts,
                                                                                           ticket.discount_cts AS t_discount_cts,
                                                                                           ticket.ext_reference AS t_ext_reference,
                                                                                           ticket.currency_code AS t_currency_code,
                                                                                           ticket.tags AS t_tags,
                                                                                           ticket.subscription_id_fk AS t_subscription_id,
                                                                                           ticket.vat_status AS t_vat_status,
                                                                                           b_transaction.id AS bt_id,
                                                                                           b_transaction.gtw_tx_id AS bt_gtw_tx_id,
                                                                                           b_transaction.gtw_payment_id AS bt_gtw_payment_id,
                                                                                           b_transaction.reservation_id AS bt_reservation_id,
                                                                                           b_transaction.t_timestamp AS bt_t_timestamp,
                                                                                           b_transaction.price_cts AS bt_price_cts,
                                                                                           b_transaction.currency AS bt_currency,
                                                                                           b_transaction.description AS bt_description,
                                                                                           b_transaction.payment_proxy AS bt_payment_proxy,
                                                                                           b_transaction.gtw_fee AS bt_gtw_fee,
                                                                                           b_transaction.plat_fee AS bt_plat_fee,
                                                                                           b_transaction.status AS bt_status,
                                                                                           b_transaction.metadata AS bt_metadata,
                                                                                           ( SELECT count(ticket_1.id) AS count
                                                                                    FROM ticket ticket_1
                                                                                    WHERE (b_transaction.reservation_id = ticket_1.tickets_reservation_id)) AS tickets_count,
                                                                                        promo_code.promo_code,
                                                                                        special_price.code AS special_price_token
                                                                                    FROM ((((tickets_reservation
                                                                                        LEFT JOIN ticket ON ((tickets_reservation.id = ticket.tickets_reservation_id)))
                                                                                        LEFT JOIN b_transaction ON (((ticket.tickets_reservation_id = b_transaction.reservation_id) AND (b_transaction.status &lt;&gt; 'INVALID'::bpchar))))
                                                                                        LEFT JOIN promo_code ON ((tickets_reservation.promo_code_id_fk = promo_code.id)))
                                                                                        LEFT JOIN special_price ON ((ticket.special_price_id_fk = special_price.id)));</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-124">
        <createIndex indexName="ticket_category_id_idx" tableName="ticket">
            <column name="category_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-125">
        <createIndex indexName="ticket_event_id_idx" tableName="ticket">
            <column name="event_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-126">
        <createIndex indexName="ticket_tickets_reservation_id_idx" tableName="ticket">
            <column name="tickets_reservation_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-127">
        <createIndex indexName="ticket_ref_unique" tableName="ticket" unique="true">
            <column name="event_id"/>
            <column name="ext_reference"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-128">
        <createIndex indexName="idx_ticket_subscription_id_fk" tableName="ticket">
            <column computed="true" name="(subscription_id_fk IS NOT NULL)"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-129">
        <addUniqueConstraint columnNames="special_price_id_fk" constraintName="unique_special_price" tableName="ticket"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-130">
        <addUniqueConstraint columnNames="uuid" constraintName="unique_ticket_uuid" tableName="ticket"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-131">
        <createTable tableName="additional_service_field_value">
            <column name="additional_service_id_fk" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="additional_service_field_value_pkey"/>
            </column>
            <column name="ticket_field_configuration_id_fk" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="additional_service_field_value_pkey"/>
            </column>
            <column name="field_value" type="VARCHAR(2048)"/>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-132">
        <createTable tableName="authority">
            <column name="username" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="role" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-133">
        <createTable tableName="ticket_category">
            <column autoIncrement="true" name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ticket_category_pkey"/>
            </column>
            <column name="inception" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="expiration" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="max_tickets" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="access_restricted" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="tc_status" type="VARCHAR(255)"/>
            <column name="event_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueBoolean="true" name="bounded" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="src_price_cts" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="category_code" type="VARCHAR(255)"/>
            <column name="valid_checkin_from" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="valid_checkin_to" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="ticket_validity_start" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="ticket_validity_end" type="TIMESTAMP WITH TIME ZONE"/>
            <column name="organization_id_fk" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="ONCE_PER_EVENT" name="ticket_checkin_strategy" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="ordinal" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="{}" name="metadata" type="JSONB">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="INHERIT" name="ticket_access_type" type="TICKET_ACCESS_TYPE">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-134">
        <addUniqueConstraint columnNames="event_id, category_code" constraintName="unique_category_code_for_event" tableName="ticket_category"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-135">
        <createIndex indexName="ticket_category_event_id_idx" tableName="ticket_category">
            <column name="event_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-136">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="a_group" constraintName="a_group_org_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-137">
        <addForeignKeyConstraint baseColumnNames="access_code_id_fk" baseTableName="special_price" constraintName="access_code_promo_code_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="promo_code" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-138">
        <addForeignKeyConstraint baseColumnNames="additional_service_id_fk" baseTableName="additional_service_description" constraintName="additional_service_description_additional_service_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="additional_service" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-139">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="additional_service_description" constraintName="additional_service_description_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-140">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="additional_service" constraintName="additional_service_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-141">
        <addForeignKeyConstraint baseColumnNames="ticket_field_configuration_id_fk" baseTableName="additional_service_field_value" constraintName="additional_service_field_valu_ticket_field_configuration_i_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket_field_configuration" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-142">
        <addForeignKeyConstraint baseColumnNames="additional_service_id_fk" baseTableName="additional_service_field_value" constraintName="additional_service_field_value_additional_service_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="additional_service" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-143">
        <addForeignKeyConstraint baseColumnNames="additional_service_id_fk" baseTableName="additional_service_item" constraintName="additional_service_item_additional_service_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="additional_service" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-144">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="additional_service_item" constraintName="additional_service_item_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-145">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="additional_service_item" constraintName="additional_service_item_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-146">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="additional_service" constraintName="additional_service_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-147">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="admin_reservation_request" constraintName="admin_reservation_request_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-148">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="auditing" constraintName="auditing_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-149">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="b_transaction" constraintName="b_transaction_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-150">
        <addForeignKeyConstraint baseColumnNames="reservation_id" baseTableName="b_transaction" constraintName="b_transaction_reservation_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="tickets_reservation" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-151">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="billing_document" constraintName="billing_document_event_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-152">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="billing_document" constraintName="billing_document_organization_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-153">
        <addForeignKeyConstraint baseColumnNames="reservation_id_fk" baseTableName="billing_document" constraintName="billing_document_reservation_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="tickets_reservation" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-154">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="configuration_event" constraintName="configuration_event_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-155">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="configuration_event" constraintName="configuration_event_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-156">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="configuration_organization" constraintName="configuration_organization_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-157">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="configuration_ticket_category" constraintName="configuration_ticket_category_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-158">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="configuration_ticket_category" constraintName="configuration_ticket_category_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-159">
        <addForeignKeyConstraint baseColumnNames="ticket_category_id_fk" baseTableName="configuration_ticket_category" constraintName="configuration_ticket_category_ticket_category_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket_category" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-160">
        <addForeignKeyConstraint baseColumnNames="event_id" baseTableName="email_message" constraintName="email_message_event_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-161">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="email_message" constraintName="email_message_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-162">
        <addForeignKeyConstraint baseColumnNames="subscription_descriptor_id_fk" baseTableName="email_message" constraintName="email_message_subscription_descriptor_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="subscription_descriptor" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-163">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="event_description_text" constraintName="event_description_text_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-164">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="event_description_text" constraintName="event_description_text_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-165">
        <addForeignKeyConstraint baseColumnNames="file_blob_id" baseTableName="event" constraintName="event_file_blob_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="file_blob" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-166">
        <addForeignKeyConstraint baseColumnNames="event_id" baseTableName="event_migration" constraintName="event_migration_event_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-167">
        <addForeignKeyConstraint baseColumnNames="org_id" baseTableName="event" constraintName="event_org_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-168">
        <addForeignKeyConstraint baseColumnNames="ecm_es_id_fk" baseTableName="extension_configuration_metadata" constraintName="extension_configuration_metadata_ecm_es_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="es_id" referencedTableName="extension_support" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-169">
        <addForeignKeyConstraint baseColumnNames="fk_ecm_id" baseTableName="extension_configuration_metadata_value" constraintName="extension_configuration_metadata_value_fk_ecm_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ecm_id" referencedTableName="extension_configuration_metadata" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-170">
        <addForeignKeyConstraint baseColumnNames="es_id_fk" baseTableName="extension_event" constraintName="extension_event_es_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="es_id" referencedTableName="extension_support" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-171">
        <addForeignKeyConstraint baseColumnNames="a_group_id_fk" baseTableName="group_link" constraintName="group_link_a_group_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="a_group" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-172">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="group_link" constraintName="group_link_event_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-173">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="group_link" constraintName="group_link_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-174">
        <addForeignKeyConstraint baseColumnNames="ticket_category_id_fk" baseTableName="group_link" constraintName="group_link_ticket_category_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket_category" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-175">
        <addForeignKeyConstraint baseColumnNames="a_group_id_fk" baseTableName="group_member" constraintName="group_member_a_group_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="a_group" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-176">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="group_member" constraintName="group_member_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-177">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="invoice_sequences" constraintName="invoice_sequences_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-178">
        <addForeignKeyConstraint baseColumnNames="org_id" baseTableName="j_user_organization" constraintName="j_user_organization_org_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-179">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="j_user_organization" constraintName="j_user_organization_user_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ba_user" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-180">
        <addForeignKeyConstraint baseColumnNames="poll_option_id_fk" baseTableName="poll_answer" constraintName="poll_answer_option_id_fk" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="poll_option" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-181">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="poll_answer" constraintName="poll_answer_org_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-182">
        <addForeignKeyConstraint baseColumnNames="poll_id_fk" baseTableName="poll_answer" constraintName="poll_answer_poll_id" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="poll" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-183">
        <addForeignKeyConstraint baseColumnNames="ticket_id_fk" baseTableName="poll_answer" constraintName="poll_answer_ticket_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-184">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="poll" constraintName="poll_event_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-185">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="poll_option" constraintName="poll_option_org_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-186">
        <addForeignKeyConstraint baseColumnNames="poll_id_fk" baseTableName="poll_option" constraintName="poll_option_poll_id" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="poll" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-187">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="poll" constraintName="poll_org_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-188">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="promo_code" constraintName="promo_code_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-189">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="promo_code" constraintName="promo_code_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-190">
        <addForeignKeyConstraint baseColumnNames="user_id_fk" baseTableName="tickets_reservation" constraintName="reservation_user_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ba_user" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-191">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="resource_event" constraintName="resource_event_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-192">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="resource_event" constraintName="resource_event_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-193">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="resource_organizer" constraintName="resource_organizer_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-194">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="scan_audit" constraintName="scan_audit_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-195">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="scan_audit" constraintName="scan_audit_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-196">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="special_price" constraintName="special_price_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-197">
        <addForeignKeyConstraint baseColumnNames="event_id" baseTableName="sponsor_scan" constraintName="sponsor_scan_event_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-198">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="sponsor_scan" constraintName="sponsor_scan_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-199">
        <addForeignKeyConstraint baseColumnNames="ticket_id" baseTableName="sponsor_scan" constraintName="sponsor_scan_ticket_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-200">
        <addForeignKeyConstraint baseColumnNames="session_id" baseTableName="spring_session_attributes" constraintName="spring_session_attributes_fk" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="session_id" referencedTableName="spring_session" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-201">
        <addForeignKeyConstraint baseColumnNames="file_blob_id_fk" baseTableName="subscription_descriptor" constraintName="subscription_descriptor_file_blob_id" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="file_blob" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-202">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="subscription_descriptor" constraintName="subscription_descriptor_organization_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-203">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="subscription_event" constraintName="subscription_event_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-204">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="subscription_event" constraintName="subscription_event_organization_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-205">
        <addForeignKeyConstraint baseColumnNames="subscription_descriptor_id_fk" baseTableName="subscription_event" constraintName="subscription_event_subscription_descriptor_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="subscription_descriptor" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-206">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="subscription" constraintName="subscription_organization_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-207">
        <addForeignKeyConstraint baseColumnNames="reservation_id_fk" baseTableName="subscription" constraintName="subscription_reservation_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="tickets_reservation" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-208">
        <addForeignKeyConstraint baseColumnNames="subscription_descriptor_fk" baseTableName="subscription" constraintName="subscription_subscription_descriptor_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="subscription_descriptor" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-209">
        <addForeignKeyConstraint baseColumnNames="event_id" baseTableName="ticket_category" constraintName="ticket_category_event_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-210">
        <addForeignKeyConstraint baseColumnNames="category_id" baseTableName="ticket" constraintName="ticket_category_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket_category" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-211">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="ticket_category" constraintName="ticket_category_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-212">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="ticket_category_text" constraintName="ticket_category_text_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-213">
        <addForeignKeyConstraint baseColumnNames="ticket_category_id_fk" baseTableName="ticket_category_text" constraintName="ticket_category_text_ticket_category_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket_category" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-214">
        <addForeignKeyConstraint baseColumnNames="event_id" baseTableName="ticket" constraintName="ticket_event_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-215">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="ticket_field_configuration" constraintName="ticket_field_configuration_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-216">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="ticket_field_configuration" constraintName="ticket_field_configuration_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-217">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="ticket_field_description" constraintName="ticket_field_description_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-218">
        <addForeignKeyConstraint baseColumnNames="ticket_field_configuration_id_fk" baseTableName="ticket_field_description" constraintName="ticket_field_description_ticket_field_configuration_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket_field_configuration" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-219">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="ticket_field_value" constraintName="ticket_field_value_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-220">
        <addForeignKeyConstraint baseColumnNames="ticket_field_configuration_id_fk" baseTableName="ticket_field_value" constraintName="ticket_field_value_ticket_field_configuration_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket_field_configuration" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-221">
        <addForeignKeyConstraint baseColumnNames="ticket_id_fk" baseTableName="ticket_field_value" constraintName="ticket_field_value_ticket_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-222">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="ticket" constraintName="ticket_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-223">
        <addForeignKeyConstraint baseColumnNames="special_price_id_fk" baseTableName="ticket" constraintName="ticket_special_price_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="special_price" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-224">
        <addForeignKeyConstraint baseColumnNames="subscription_id_fk" baseTableName="ticket" constraintName="ticket_subscription_applied" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="subscription" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-225">
        <addForeignKeyConstraint baseColumnNames="subscription_id_fk" baseTableName="tickets_reservation" constraintName="ticket_subscription_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="subscription" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-226">
        <addForeignKeyConstraint baseColumnNames="tickets_reservation_id" baseTableName="ticket" constraintName="ticket_tickets_reservation_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="tickets_reservation" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-227">
        <addForeignKeyConstraint baseColumnNames="event_id_fk" baseTableName="tickets_reservation" constraintName="tickets_reservation_event_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-228">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="tickets_reservation" constraintName="tickets_reservation_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-229">
        <addForeignKeyConstraint baseColumnNames="promo_code_id_fk" baseTableName="tickets_reservation" constraintName="tickets_reservation_promo_code_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="promo_code" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-230">
        <addForeignKeyConstraint baseColumnNames="user_id_fk" baseTableName="user_profile" constraintName="user_profile_user_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ba_user" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-231">
        <addForeignKeyConstraint baseColumnNames="event_id" baseTableName="waiting_queue" constraintName="waiting_queue_event_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="event" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-232">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="waiting_queue" constraintName="waiting_queue_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-233">
        <addForeignKeyConstraint baseColumnNames="ticket_reservation_id" baseTableName="waiting_queue" constraintName="waiting_queue_ticket_reservation_id_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="tickets_reservation" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-234">
        <addForeignKeyConstraint baseColumnNames="group_link_id_fk" baseTableName="whitelisted_ticket" constraintName="whitelisted_ticket_group_link_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="group_link" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-235">
        <addForeignKeyConstraint baseColumnNames="group_member_id_fk" baseTableName="whitelisted_ticket" constraintName="whitelisted_ticket_group_member_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="group_member" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-236">
        <addForeignKeyConstraint baseColumnNames="organization_id_fk" baseTableName="whitelisted_ticket" constraintName="whitelisted_ticket_organization_id_fk_fkey" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="organization" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-237">
        <addForeignKeyConstraint baseColumnNames="ticket_id_fk" baseTableName="whitelisted_ticket" constraintName="whitelisted_ticket_ticket_id_fk" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ticket" validate="true"/>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-238">
        <createView fullDefinition="false" viewName="checkin_ticket_event_and_category_info">SELECT t.id AS t_id,
                                                                                                    t.uuid AS t_uuid,
                                                                                                    t.creation AS t_creation,
                                                                                                    t.category_id AS t_category_id,
                                                                                                    t.status AS t_status,
                                                                                                    t.event_id AS t_event_id,
                                                                                                    t.src_price_cts AS t_src_price_cts,
                                                                                                    t.final_price_cts AS t_final_price_cts,
                                                                                                    t.vat_cts AS t_vat_cts,
                                                                                                    t.discount_cts AS t_discount_cts,
                                                                                                    t.tickets_reservation_id AS t_tickets_reservation_id,
                                                                                                    t.full_name AS t_full_name,
                                                                                                    t.first_name AS t_first_name,
                                                                                                    t.last_name AS t_last_name,
                                                                                                    t.email_address AS t_email_address,
                                                                                                    t.locked_assignment AS t_locked_assignment,
                                                                                                    t.user_language AS t_user_language,
                                                                                                    t.ext_reference AS t_ext_reference,
                                                                                                    t.currency_code AS t_currency_code,
                                                                                                    t.tags AS t_tags,
                                                                                                    t.subscription_id_fk AS t_subscription_id,
                                                                                                    t.vat_status AS t_vat_status,
                                                                                                    tr.id AS tr_id,
                                                                                                    tr.validity AS tr_validity,
                                                                                                    tr.status AS tr_status,
                                                                                                    tr.full_name AS tr_full_name,
                                                                                                    tr.first_name AS tr_first_name,
                                                                                                    tr.last_name AS tr_last_name,
                                                                                                    tr.email_address AS tr_email_address,
                                                                                                    tr.billing_address AS tr_billing_address,
                                                                                                    tr.confirmation_ts AS tr_confirmation_ts,
                                                                                                    tr.latest_reminder_ts AS tr_latest_reminder_ts,
                                                                                                    tr.payment_method AS tr_payment_method,
                                                                                                    tr.offline_payment_reminder_sent AS tr_offline_payment_reminder_sent,
                                                                                                    tr.promo_code_id_fk AS tr_promo_code_id_fk,
                                                                                                    tr.automatic AS tr_automatic,
                                                                                                    tr.user_language AS tr_user_language,
                                                                                                    tr.direct_assignment AS tr_direct_assignment,
                                                                                                    tr.invoice_number AS tr_invoice_number,
                                                                                                    tr.invoice_model AS tr_invoice_model,
                                                                                                    tr.vat_status AS tr_vat_status,
                                                                                                    tr.vat_nr AS tr_vat_nr,
                                                                                                    tr.vat_country AS tr_vat_country,
                                                                                                    tr.invoice_requested AS tr_invoice_requested,
                                                                                                    tr.used_vat_percent AS tr_used_vat_percent,
                                                                                                    tr.vat_included AS tr_vat_included,
                                                                                                    tr.creation_ts AS tr_creation_ts,
                                                                                                    tr.customer_reference AS tr_customer_reference,
                                                                                                    tr.registration_ts AS tr_registration_ts,
                                                                                                    tr.billing_address_company AS tr_billing_address_company,
                                                                                                    tr.billing_address_line1 AS tr_billing_address_line1,
                                                                                                    tr.billing_address_line2 AS tr_billing_address_line2,
                                                                                                    tr.billing_address_city AS tr_billing_address_city,
                                                                                                    tr.billing_address_state AS tr_billing_address_state,
                                                                                                    tr.billing_address_zip AS tr_billing_address_zip,
                                                                                                    tr.invoicing_additional_information AS tr_invoicing_additional_information,
                                                                                                    tr.src_price_cts AS tr_src_price_cts,
                                                                                                    tr.final_price_cts AS tr_final_price_cts,
                                                                                                    tr.vat_cts AS tr_vat_cts,
                                                                                                    tr.discount_cts AS tr_discount_cts,
                                                                                                    tr.currency_code AS tr_currency_code,
                                                                                                    tc.id AS tc_id,
                                                                                                    tc.inception AS tc_inception,
                                                                                                    tc.expiration AS tc_expiration,
                                                                                                    tc.max_tickets AS tc_max_tickets,
                                                                                                    tc.name AS tc_name,
                                                                                                    tc.src_price_cts AS tc_src_price_cts,
                                                                                                    tc.access_restricted AS tc_access_restricted,
                                                                                                    tc.tc_status AS tc_tc_status,
                                                                                                    tc.event_id AS tc_event_id,
                                                                                                    tc.bounded AS tc_bounded,
                                                                                                    tc.category_code AS tc_category_code,
                                                                                                    tc.valid_checkin_from AS tc_valid_checkin_from,
                                                                                                    tc.valid_checkin_to AS tc_valid_checkin_to,
                                                                                                    tc.ticket_validity_start AS tc_ticket_validity_start,
                                                                                                    tc.ticket_validity_end AS tc_ticket_validity_end,
                                                                                                    tc.ordinal AS tc_ordinal,
                                                                                                    tc.ticket_checkin_strategy AS tc_ticket_checkin_strategy,
                                                                                                    tc.metadata AS tc_metadata,
                                                                                                    tc.ticket_access_type AS tc_ticket_access_type,
                                                                                                    e.id AS e_id,
                                                                                                    e.format AS e_format,
                                                                                                    e.short_name AS e_short_name,
                                                                                                    e.display_name AS e_display_name,
                                                                                                    e.start_ts AS e_start_ts,
                                                                                                    e.end_ts AS e_end_ts,
                                                                                                    e.time_zone AS e_time_zone,
                                                                                                    e.private_key AS e_private_key,
                                                                                                    e.metadata AS e_metadata,
                                                                                                    e.org_id AS e_org_id,
                                                                                                    e.locales AS e_locales,
                                                                                                    ( SELECT jsonb_object_agg(tfc.field_name,
                                                                                                                              CASE tfc.field_type
                                                                                                                                  WHEN 'checkbox'::text THEN (tfv.field_value)::jsonb
                                                                                                                                  ELSE jsonb_build_array(tfv.field_value)
                                                                                                                                  END) AS additional_info
                                                                                                      FROM (ticket_field_value tfv
                                                                                                               JOIN ticket_field_configuration tfc ON ((tfv.ticket_field_configuration_id_fk = tfc.id)))
                                                                                                      WHERE (tfc.event_id_fk = e.id)) AS tai_additional_info
                                                                                             FROM (((ticket t
                                                                                                 JOIN tickets_reservation tr ON ((t.tickets_reservation_id = tr.id)))
                                                                                                 JOIN ticket_category tc ON ((t.category_id = tc.id)))
                                                                                                      JOIN event e ON ((e.id = t.event_id)))
                                                                                             WHERE (((t.status)::text = ANY ((ARRAY['ACQUIRED'::character varying, 'CHECKED_IN'::character varying])::text[])) AND (t.first_name IS NOT NULL) AND (((t.first_name)::text &lt;&gt; ''::text) IS TRUE) AND (t.last_name IS NOT NULL) AND (((t.last_name)::text &lt;&gt; ''::text) IS TRUE) AND (t.email_address IS NOT NULL) AND (((t.email_address)::text &lt;&gt; ''::text) IS TRUE));</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-239">
        <createView fullDefinition="false" viewName="events_statistics">SELECT event.id,
                                                                               ( SELECT count(ticket.id) AS count
                                                                        FROM ticket
                                                                        WHERE ((ticket.event_id = event.id) AND ((ticket.status)::text &lt;&gt; ALL ((ARRAY['INVALIDATED'::character varying, 'EXPIRED'::character varying])::text[])))) AS available_seats,
                                                                            CASE stats.contains_unbounded_categories
                                                                            WHEN true THEN (0)::bigint
                                                                            ELSE (( SELECT count(ticket.id) AS count
                                                                            FROM ticket
                                                                            WHERE ((ticket.event_id = event.id) AND ((ticket.status)::text &lt;&gt; ALL ((ARRAY['INVALIDATED'::character varying, 'EXPIRED'::character varying])::text[])))) - stats.allocated_count)
        END AS not_allocated_tickets,
    stats.pending_count AS pending_tickets,
    stats.sold_tickets_count AS sold_tickets,
    ( SELECT (stats.released_count + (count(ticket.id))::numeric)
           FROM ticket
          WHERE ((ticket.event_id = event.id) AND ((ticket.status)::text = 'RELEASED'::text) AND (ticket.category_id IS NULL))) AS released_tickets,
    stats.checked_in_count AS checked_in_tickets,
        CASE stats.contains_unbounded_categories
            WHEN true THEN (((((((( SELECT count(ticket.id) AS count
               FROM ticket
              WHERE ((ticket.event_id = event.id) AND ((ticket.status)::text &lt;&gt; ALL ((ARRAY['INVALIDATED'::character varying, 'EXPIRED'::character varying])::text[])))) - stats.allocated_count))::numeric - stats.released_count) - stats.sold_tickets_count_unbounded) - stats.checked_in_count_unbounded) - stats.pending_count_unbounded) - (( SELECT count(*) AS count
               FROM ticket
              WHERE (((ticket.status)::text = 'RELEASED'::text) AND (ticket.category_id IS NULL) AND (ticket.event_id = event.id))))::numeric)
            ELSE (0)::numeric
        END AS dynamic_allocation,
        CASE stats.contains_unbounded_categories
            WHEN true THEN ((((stats.allocated_count)::numeric - stats.sold_tickets_count_bounded) - stats.checked_in_count_bounded) - stats.pending_count_bounded)
            ELSE ((((stats.allocated_count)::numeric - stats.sold_tickets_count) - stats.checked_in_count) - stats.pending_count)
        END AS not_sold_tickets,
    (stats.is_containing_orphan_tickets_count &gt; 0) AS is_containing_orphan_tickets,
    (stats.is_containing_stuck_tickets_count &gt; 0) AS is_containing_stuck_tickets_count,
    (stats.public_and_valid_count &gt; 0) AS show_public_statistics
   FROM (( SELECT sum(ticket_category_statistics.sold_tickets_count) AS sold_tickets_count,
            sum(ticket_category_statistics.checked_in_count) AS checked_in_count,
            sum(ticket_category_statistics.pending_count) AS pending_count,
            sum(ticket_category_statistics.released_count) AS released_count,
            sum(
                CASE ticket_category_statistics.bounded
                    WHEN true THEN ticket_category_statistics.checked_in_count
                    ELSE (0)::bigint
                END) AS checked_in_count_bounded,
            sum(
                CASE (ticket_category_statistics.bounded = false)
                    WHEN true THEN ticket_category_statistics.checked_in_count
                    ELSE (0)::bigint
                END) AS checked_in_count_unbounded,
            sum(
                CASE ticket_category_statistics.bounded
                    WHEN true THEN ticket_category_statistics.max_tickets
                    ELSE 0
                END) AS allocated_count,
            sum(
                CASE ticket_category_statistics.bounded
                    WHEN true THEN ticket_category_statistics.sold_tickets_count
                    ELSE (0)::bigint
                END) AS sold_tickets_count_bounded,
            sum(
                CASE (ticket_category_statistics.bounded = false)
                    WHEN true THEN ticket_category_statistics.sold_tickets_count
                    ELSE (0)::bigint
                END) AS sold_tickets_count_unbounded,
            sum(
                CASE (ticket_category_statistics.bounded = false)
                    WHEN true THEN ticket_category_statistics.pending_count
                    ELSE (0)::bigint
                END) AS pending_count_unbounded,
            sum(
                CASE ticket_category_statistics.bounded
                    WHEN true THEN ticket_category_statistics.pending_count
                    ELSE (0)::bigint
                END) AS pending_count_bounded,
            (sum(
                CASE ticket_category_statistics.bounded
                    WHEN false THEN 1
                    ELSE 0
                END) &gt; 0) AS contains_unbounded_categories,
            sum(
                CASE ticket_category_statistics.is_containing_orphan_tickets
                    WHEN true THEN 1
                    ELSE 0
                END) AS is_containing_orphan_tickets_count,
            sum(
                CASE ticket_category_statistics.is_containing_stuck_tickets
                    WHEN true THEN 1
                    ELSE 0
                END) AS is_containing_stuck_tickets_count,
            sum(
                CASE ((ticket_category_statistics.access_restricted = false) AND (ticket_category_statistics.is_expired = false))
                    WHEN true THEN 1
                    ELSE 0
                END) AS public_and_valid_count,
            ticket_category_statistics.event_id
           FROM ticket_category_statistics
          GROUP BY ticket_category_statistics.event_id) stats
     JOIN event ON ((stats.event_id = event.id)))
  ORDER BY event.start_ts, event.end_ts;</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-240">
        <createView fullDefinition="false" viewName="reservation_with_purchase_context">WITH reservations AS (
            SELECT tickets_reservation.id AS tr_id,
                   tickets_reservation.validity AS tr_validity,
                   tickets_reservation.status AS tr_status,
                   tickets_reservation.creation_ts AS tr_creation_ts,
                   tickets_reservation.confirmation_ts AS tr_confirmation_ts,
                   tickets_reservation.registration_ts AS tr_registration_ts,
                   tickets_reservation.payment_method AS tr_payment_method,
                   tickets_reservation.invoice_number AS tr_invoice_number,
                   tickets_reservation.vat_status AS tr_vat_status,
                   tickets_reservation.used_vat_percent AS tr_used_vat_percent,
                   tickets_reservation.src_price_cts AS tr_src_price_cts,
                   tickets_reservation.final_price_cts AS tr_final_price_cts,
                   tickets_reservation.vat_cts AS tr_vat_cts,
                   tickets_reservation.discount_cts AS tr_discount_cts,
                   tickets_reservation.currency_code AS tr_currency_code,
                   tickets_reservation.event_id_fk AS tr_event_id_fk,
                   tickets_reservation.user_id_fk AS tr_user_id_fk
            FROM tickets_reservation
            WHERE ((tickets_reservation.user_id_fk IS NOT NULL) AND ((tickets_reservation.status)::text &lt;&gt; 'CANCELLED'::text))
                                                                                            ), ticketsjsonb AS (
                                                                                        SELECT jsonb_agg(jsonb_build_object('id', t.uuid, 'firstName', t.first_name, 'lastName', t.last_name, 'type', jsonb_build_object('en', tc.name))) AS t_tickets,
                                                                                            t.tickets_reservation_id AS t_reservation_id
                                                                                        FROM (ticket t
                                                                                            LEFT JOIN ticket_category tc ON ((t.category_id = tc.id)))
                                                                                        GROUP BY t.tickets_reservation_id
                                                                                            ), subscriptionsjsonb AS (
                                                                                        SELECT jsonb_agg(jsonb_build_object('id', s.id, 'firstName', s.first_name, 'lastName', s.last_name, 'type', d.title)) AS s_subscriptions,
                                                                                            s.reservation_id_fk AS s_reservation_id
                                                                                        FROM (subscription s
                                                                                            JOIN subscription_descriptor d ON ((s.subscription_descriptor_fk = d.id)))
                                                                                        GROUP BY s.reservation_id_fk
                                                                                            )
        SELECT res.tr_id,
               res.tr_validity,
               res.tr_status,
               res.tr_creation_ts,
               res.tr_confirmation_ts,
               res.tr_registration_ts,
               res.tr_payment_method,
               res.tr_invoice_number,
               res.tr_vat_status,
               res.tr_used_vat_percent,
               res.tr_src_price_cts,
               res.tr_final_price_cts,
               res.tr_vat_cts,
               res.tr_discount_cts,
               res.tr_currency_code,
               res.tr_event_id_fk,
               res.tr_user_id_fk,
               'event'::text AS pc_type,
          e.time_zone AS pc_time_zone,
               e.start_ts AS pc_start_date,
               e.end_ts AS pc_end_date,
               e.short_name AS pc_public_identifier,
               jsonb_build_object('en', e.display_name) AS pc_title,
               t.t_tickets AS pc_items
        FROM ((reservations res
            JOIN event e ON ((e.id = res.tr_event_id_fk)))
                 JOIN ticketsjsonb t ON ((t.t_reservation_id = res.tr_id)))
        UNION
        SELECT res.tr_id,
               res.tr_validity,
               res.tr_status,
               res.tr_creation_ts,
               res.tr_confirmation_ts,
               res.tr_registration_ts,
               res.tr_payment_method,
               res.tr_invoice_number,
               res.tr_vat_status,
               res.tr_used_vat_percent,
               res.tr_src_price_cts,
               res.tr_final_price_cts,
               res.tr_vat_cts,
               res.tr_discount_cts,
               res.tr_currency_code,
               res.tr_event_id_fk,
               res.tr_user_id_fk,
               'subscription'::text AS pc_type,
          sd.time_zone AS pc_time_zone,
               s.validity_from AS pc_start_date,
               s.validity_to AS pc_end_date,
               (sd.id)::text AS pc_public_identifier,
          sd.title AS pc_title,
               sj.s_subscriptions AS pc_items
        FROM (((reservations res
            JOIN subscription s ON ((s.reservation_id_fk = res.tr_id)))
            JOIN subscription_descriptor sd ON ((sd.id = s.subscription_descriptor_fk)))
                 JOIN subscriptionsjsonb sj ON ((sj.s_reservation_id = res.tr_id)));</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-241">
        <createView fullDefinition="false" viewName="ticket_category_statistics">SELECT res.ticket_category_id,
                                                                                        res.access_restricted,
                                                                                        res.max_tickets,
                                                                                        res.bounded,
                                                                                        res.is_expired,
                                                                                        res.event_id,
                                                                                        res.pending_count,
                                                                                        res.checked_in_count,
                                                                                        res.sold_tickets_count,
                                                                                        res.released_count,
                                                                                        res.not_sold_tickets,
                                                                                        res.stuck_count,
                                                                                        (res.is_expired AND (res.not_sold_tickets &gt; 0)) AS is_containing_orphan_tickets,
                                                                                        (res.stuck_count &gt; 0) AS is_containing_stuck_tickets
                                                                                 FROM ( SELECT ticket_cat.id AS ticket_category_id,
                                                                                               ticket_cat.access_restricted,
                                                                                               ticket_cat.max_tickets,
                                                                                               ticket_cat.bounded,
                                                                                               ticket_cat.is_expired,
                                                                                               ticket_cat.event_id,
                                                                                               COALESCE(tickets_stats.pending_count, (0)::bigint) AS pending_count,
                                                                                               COALESCE(tickets_stats.checked_in_count, (0)::bigint) AS checked_in_count,
                                                                                               COALESCE(tickets_stats.sold_tickets_count, (0)::bigint) AS sold_tickets_count,
                                                                                               COALESCE(tickets_stats.released_count, (0)::bigint) AS released_count,
                                                                                               CASE ticket_cat.bounded
                                                                                                   WHEN false THEN (0)::bigint
                                                                                                   ELSE (((ticket_cat.max_tickets - COALESCE(tickets_stats.sold_tickets_count, (0)::bigint)) - COALESCE(tickets_stats.checked_in_count, (0)::bigint)) - COALESCE(tickets_stats.pending_count, (0)::bigint))
                                                                                                   END AS not_sold_tickets,
                                                                                               COALESCE(stuck_count.stuck_count, (0)::bigint) AS stuck_count
                                                                                        FROM ((( SELECT ticket_category.max_tickets,
                                                                                                        ticket_category.bounded,
                                                                                                        ticket_category.id,
                                                                                                        ticket_category.event_id,
                                                                                                        (ticket_category.expiration &lt; now()) AS is_expired,
                                                                                                        ticket_category.access_restricted
                                                                                                 FROM ticket_category
                                                                                                 WHERE ((ticket_category.tc_status)::text = 'ACTIVE'::text)) ticket_cat
                                                                                            LEFT JOIN ( SELECT sum(
                                                                                                                 CASE ((ticket.status)::text = 'PENDING'::text)
                            WHEN true THEN 1
                            ELSE 0
                        END) AS pending_count,
                                                                                                               sum(
                                                                                                                 CASE ((ticket.status)::text = 'RELEASED'::text)
                            WHEN true THEN 1
                            ELSE 0
                        END) AS released_count,
                                                                                                               sum(
                                                                                                                 CASE ((ticket.status)::text = 'CHECKED_IN'::text)
                            WHEN true THEN 1
                            ELSE 0
                        END) AS checked_in_count,
                                                                                                               sum(
                                                                                                                 CASE ((ticket.status)::text = ANY ((ARRAY['TO_BE_PAID'::character varying, 'ACQUIRED'::character varying])::text[]))
                            WHEN true THEN 1
                            ELSE 0
                        END) AS sold_tickets_count,
                                                                                                               ticket.category_id
                                                                                                        FROM (ticket
                                                                                                            JOIN ticket_category tc ON ((ticket.category_id = tc.id)))
                                                                                                        GROUP BY ticket.category_id) tickets_stats ON ((ticket_cat.id = tickets_stats.category_id)))
                                                                                                 LEFT JOIN ( SELECT count(*) AS stuck_count,
                                                                                                                    ticket.category_id
                                                                                                             FROM (ticket
                                                                                                                 JOIN tickets_reservation ON ((tickets_reservation.id = ticket.tickets_reservation_id)))
                                                                                                             WHERE ((tickets_reservation.status)::text = 'STUCK'::text)
                                                                                        GROUP BY ticket.category_id) stuck_count ON ((ticket_cat.id = stuck_count.category_id)))) res;</createView>
    </changeSet>
    <changeSet author="jungsoo" id="1651569389840-242">
        <createView fullDefinition="false" viewName="ticket_category_with_currency">SELECT tc.id,
                                                                                           tc.inception,
                                                                                           tc.expiration,
                                                                                           tc.max_tickets,
                                                                                           tc.name,
                                                                                           tc.price_cts,
                                                                                           tc.access_restricted,
                                                                                           tc.tc_status,
                                                                                           tc.event_id,
                                                                                           tc.bounded,
                                                                                           tc.src_price_cts,
                                                                                           tc.category_code,
                                                                                           tc.valid_checkin_from,
                                                                                           tc.valid_checkin_to,
                                                                                           tc.ticket_validity_start,
                                                                                           tc.ticket_validity_end,
                                                                                           tc.organization_id_fk,
                                                                                           tc.ordinal,
                                                                                           tc.ticket_checkin_strategy,
                                                                                           tc.ticket_access_type,
                                                                                           e.currency AS currency_code
                                                                                    FROM ticket_category tc,
                                                                                         event e
                                                                                    WHERE (tc.event_id = e.id);</createView>
    </changeSet>
</databaseChangeLog>
